<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Order Form</title>
  <style>
    body { font-family: 'Poppins', sans-serif; background:#f5f7fa; padding:40px; color:#222 }
    h1{ text-align:center; margin-bottom:20px }
    form{ max-width:420px; margin:0 auto; background:#fff; padding:22px; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,.06); display:flex; flex-direction:column; gap:12px }
    input, textarea, button{ padding:12px; border-radius:8px; border:1px solid #dcdcdc; font-size:1rem }
    button{ background:#007bff; color:#fff; border:none; cursor:pointer; font-weight:600 }
    button:disabled{ opacity:.7; cursor:not-allowed }
    .loader{ display:none; margin:18px auto; border:4px solid #eee; border-top:4px solid #007bff; border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite }
    @keyframes spin{ to{ transform:rotate(360deg) } }
    .success-message{ display:none; max-width:420px; margin:24px auto 0; background:#d4edda; color:#155724; padding:18px; border-radius:10px; box-shadow:0 6px 14px rgba(0,128,0,0.08); text-align:center; font-weight:600; animation:fadeInUp .45s ease both }
    @keyframes fadeInUp{ from{opacity:0; transform:translateY(18px)} to{opacity:1; transform:translateY(0)} }
    /* hide honeypot visually */
    .hidden { display:none !important; }
  </style>
</head>
<body>
  <h1>üõí Place Your Order</h1>

  <!-- 
    Netlify form attributes:
      - data-netlify="true" -> tells Netlify to capture the form
      - data-netlify-honeypot="bot-field" -> spam trap field
      - hidden input form-name -> required for Netlify AJAX submissions
    Also include action="/success" to provide a non-JS fallback redirect (optional)
  -->
  <form id="orderForm" name="order" method="POST" action="/success" data-netlify="true" data-netlify-honeypot="bot-field" netlify>
    <!-- required hidden field so Netlify recognizes the form when using JS -->
    <input type="hidden" name="form-name" value="order">

    <!-- honeypot field (spam trap). Keep visually hidden -->
    <p class="hidden">
      <label>Don't fill this out if you're human: <input name="bot-field" /></label>
    </p>

    <input type="text" name="name" placeholder="Your Name" required />
    <input type="email" name="email" placeholder="Email" required />
    <input type="text" name="product" placeholder="Product Name" required />
    <input type="number" name="quantity" placeholder="Quantity" required min="1" />
    <textarea name="message" placeholder="Additional details (optional)"></textarea>

    <button type="submit">Submit Order</button>
  </form>

  <div id="loader" class="loader" aria-hidden="true"></div>

  <div id="successMsg" class="success-message" role="status" aria-live="polite">
    ‚úÖ Your order has been submitted successfully! We‚Äôll contact you soon.
  </div>

  <script>
    (function () {
      const form = document.getElementById('orderForm');
      const loader = document.getElementById('loader');
      const successMsg = document.getElementById('successMsg');
      const submitBtn = form.querySelector('button[type="submit"]');

      // Helper to encode FormData as x-www-form-urlencoded
      function encodeFormAsQuery(formData) {
        return new URLSearchParams(formData).toString();
      }

      form.addEventListener('submit', function (e) {
        // If the browser doesn't support fetch or you want fallback to normal post,
        // do nothing here (leave form to submit normally). We intercept to show loader & use AJAX.
        e.preventDefault();

        // spam honeypot - if filled, abort
        const botField = form.querySelector('input[name="bot-field"]');
        if (botField && botField.value) return;

        submitBtn.disabled = true;
        loader.style.display = 'block';

        const formData = new FormData(form);

        // Ensure the form-name is included (it is via the hidden input, but ensure anyway)
        if (!formData.get('form-name')) formData.append('form-name', form.getAttribute('name') || 'order');

        fetch('/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: encodeFormAsQuery(formData)
        })
        .then(response => {
          // Netlify returns 200 on success for AJAX; show success UI
          loader.style.display = 'none';
          form.style.display = 'none';
          successMsg.style.display = 'block';
        })
        .catch(err => {
          loader.style.display = 'none';
          submitBtn.disabled = false;
          alert('‚ùå Error submitting form. Try again or contact via email.');
          console.error(err);
        });
      });
    })();
  </script>
</body>
</html>
